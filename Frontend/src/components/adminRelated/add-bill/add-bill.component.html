<nav class="wm-navbar">
  <div class="wm-container">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="bolt">
          <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </div>
      <a href="/"><span class="brand-name">PowerEase Admin</span></a>
    </div>

    <ul class="nav-links">
      <li><a routerLink="/admin/home" style="color:#0EA5A4;">Dashboard</a></li>
      <li><a routerLink="/admin/add-customer">Add Customer</a></li>
      <li><a routerLink="/admin/update-customer">Update Customer</a></li>
      <li><a routerLink="/admin/manage-connection">Manage Connection</a></li>
      <li><a routerLink="/admin/complaints" style="color:red">View Complaints</a></li>
    </ul>
  </div>
</nav>

<div class="container mt-4">
  <h2 class="text-center mb-4">Add New Bill</h2>

  <form (ngSubmit)="addBill()" #billForm="ngForm" class="card p-4 shadow-sm">
    <!-- Customer ID -->
    <div class="form-group mb-3">
      <label for="consumerNumber" class="form-label">Consumer Number</label>
      <div class="d-flex">
        <input id="consumerNumber" type="text" class="form-control custom-input" name="consumerNumber" maxlength="13"
          minlength="13" pattern="^[1-9][0-9]{12}$" [(ngModel)]="bill.consumerNumber"
          placeholder="Enter 13-digit Consumer Number" required #consumerRef="ngModel" />
      </div>
      <small style="color:red" *ngIf="consumerRef.value && consumerRef.invalid && consumerRef.touched">
        Invalid consumer number</small>
    </div>

    <!-- Month -->
    <div class="form-group mb-3">
  <label for="billingMonth">Billing Month:</label>

  <input
    type="month"
    id="billingMonth"
    name="billingMonth"
    class="form-control"
    [(ngModel)]="bill.billingMonth"
    (change)="onBillingMonthChange()"
    required
    [min]="minBillingMonth"
    [max]="maxBillingMonth"
  />

  <div *ngIf="bill.billingMonth && bill.billingMonth < minBillingMonth" class="text-danger small mt-1">
    <small>You can only select last 2 months.</small>
  </div>
</div>



    <!-- Due Date -->
  <div class="form-group mb-3">
  <label for="dueDate">Due Date:</label>

  <input 
    type="date" 
    id="dueDate" 
    name="dueDate" 
    class="form-control"
    [(ngModel)]="bill.dueDate"
    [min]="dueDateMin"
    [max]="dueDateMax"
    required
  />

  <div *ngIf="bill.dueDate && (bill.dueDate < dueDateMin || bill.dueDate > dueDateMax)" class="text-danger small mt-1">
    <small>Due date must be in the month after billing month.</small>
  </div>
</div>


    <!-- Units -->
    <div class="form-group mb-3">
  <label for="unitsConsumed">Units Consumed:</label>
  <input 
    type="number"
    id="unitsConsumed"
    name="unitsConsumed"
    class="form-control"
    [(ngModel)]="bill.unitsConsumed"
    placeholder="Enter number of units"
    required
    pattern="^[0-9]+$"
    #unitsConsumedRef="ngModel"
  />
   <small class="text-danger" *ngIf="unitsConsumedRef.value &&  unitsConsumedRef.touched && unitsConsumedRef.invalid">
            <span *ngIf="unitsConsumedRef.errors?.['pattern']">Can't be negative.</span>
          </small>
</div>


    <!-- Amount -->
    <div class="form-group mb-3">
      <label for="pricePerUnit">Price Per Unit:</label>
      <select id="pricePerUnit" name="pricePerUnit" class="form-control" [(ngModel)]="bill.pricePerUnit" required #unitpriceRef="ngModel">
        <option value="" disabled>Select Price</option>
        <option [value]="5">5.00 (Residential)</option>
        <option [value]="7">7.00 (Commercial)</option>
      </select>
      <small class="text-danger" *ngIf="unitpriceRef.value &&  unitpriceRef.touched && unitpriceRef.invalid">
            <span *ngIf="unitpriceRef.errors?.['required']">Unit price is required.</span>
          </small>
    </div>

    <div class="text-center">
      <button class="btn btn-primary w-50" [disabled]="!billForm.form.valid">
        Add Bill
      </button>
    </div>
  </form>

</div>

<div *ngIf="successMessage" class="alert alert-success text-center top-alert mt-4">
  {{ successMessage }}
</div>

<div *ngIf="errorMessage" class="alert alert-danger text-center top-alert mt-4">
  {{ errorMessage }}
</div>