<nav class="wm-navbar">
  <div class="wm-container">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="bolt">
          <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"
                stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <a href="/"><span class="brand-name">PowerEase Admin</span></a>
    </div>

    <ul class="nav-links">
      <li><a routerLink="/admin/home" style="color:#0EA5A4;">Dashboard</a></li>
      <li><a routerLink="/admin/add-bill">Add Bill</a></li>
      <li><a routerLink="/admin/complaints" style="color:red">View Complaints</a></li>
    </ul>
  </div>
</nav>

<div class="container mt-4">
  <h2 class="text-center mb-4">Add New Customer</h2>

  <form #customerForm="ngForm" (ngSubmit)="addCustomer()" novalidate class="card p-4 shadow-sm">

    <div class="row">
      <!-- Full Name -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Full Name</label>
        <input type="text" name="fullName" class="form-control"
          [(ngModel)]="user.fullName"
          #fullName="ngModel"
          required pattern="^[A-Za-z ]{3,}$"
          placeholder="Enter customer name">
        <div *ngIf="fullName.invalid && fullName.touched" class="text-danger small">
          <div *ngIf="fullName.errors?.['required']">Full name is required.</div>
          <div *ngIf="fullName.errors?.['pattern']">Only letters & spaces allowed (min 3 chars).</div>
        </div>
      </div>

      <!-- Consumer Number -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Consumer Number</label>
        <input type="text" name="consumerNumber" class="form-control"
          [(ngModel)]="user.consumerNumber"
          #consumerNumber="ngModel"
          required pattern="^[1-9][0-9]{12}$"
          placeholder="Enter 13-digit consumer number">
        <div *ngIf="consumerNumber.invalid && consumerNumber.touched" class="text-danger small">
          <div *ngIf="consumerNumber.errors?.['required']">Consumer number is required.</div>
          <div *ngIf="consumerNumber.errors?.['pattern']">Must be 13 digits and not start with 0.</div>
        </div>
      </div>

      <!-- Email -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Email</label>
        <input type="email" name="email" class="form-control"
          [(ngModel)]="user.email"
          #email="ngModel"
          required email placeholder="Enter email">
        <div *ngIf="email.invalid && email.touched" class="text-danger small">
          <div *ngIf="email.errors?.['required']">Email is required.</div>
          <div *ngIf="email.errors?.['email']">Invalid email format.</div>
        </div>
      </div>

      <!-- Phone -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Phone Number</label>
        <input type="text" name="mobile" class="form-control"
          [(ngModel)]="user.mobile"
          #mobile="ngModel"
          required pattern="^[6-9][0-9]{9}$"
          placeholder="Enter 10-digit phone number">
        <div *ngIf="mobile.invalid && mobile.touched" class="text-danger small">
          <div *ngIf="mobile.errors?.['required']">Phone number is required.</div>
          <div *ngIf="mobile.errors?.['pattern']">Must be a valid 10-digit number (starts 6-9).</div>
        </div>
      </div>

      <!-- Electrical Section -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Electrical Section</label>
        <input type="text" name="electricalSection" class="form-control"
          [(ngModel)]="user.electricalSection"
          #electricalSection="ngModel"
          required pattern="^[A-Za-z0-9 ]{3,}$"
          placeholder="Enter electrical section">
        <div *ngIf="electricalSection.invalid && electricalSection.touched" class="text-danger small">
          <div *ngIf="electricalSection.errors?.['required']">Electrical section is required.</div>
          <div *ngIf="electricalSection.errors?.['pattern']">Minimum 3 characters, letters/numbers only.</div>
        </div>
      </div>

      <!-- Connection Type -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Connection Type</label>
        <select name="customerType" class="form-control"
          [(ngModel)]="user.customerType"
          #customerType="ngModel"
          required>
          <option value="">Select Type</option>
          <option value="Residential">Residential</option>
          <option value="Commercial">Commercial</option>
        </select>
        <div *ngIf="customerType.invalid && customerType.touched" class="text-danger small">
          Connection type is required.
        </div>
      </div>

      <!-- Pincode -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Pincode</label>
        <input type="text" name="pincode" class="form-control"
          [(ngModel)]="user.pincode"
          #pincode="ngModel"
          required pattern="^[1-9][0-9]{5}$"
          placeholder="Enter 6-digit pincode"
          (blur)="fetchLocationByPincode()">
        <div *ngIf="pincode.invalid && pincode.touched" class="text-danger small">
          <div *ngIf="pincode.errors?.['required']">Pincode is required.</div>
          <div *ngIf="pincode.errors?.['pattern']">Must be 6 digits and not start with 0.</div>
        </div>
      </div>

      <!-- State -->
      <div class="col-md-6 mb-3">
        <label class="form-label">State</label>
        <select name="state" class="form-control"
          [(ngModel)]="user.state"
          #state="ngModel"
          required (change)="onStateChange()">
          <option value="">Select State</option>
          <option *ngFor="let s of states" [value]="s.name">{{ s.name }}</option>
        </select>
        <div *ngIf="state.invalid && state.touched" class="text-danger small">
          State is required.
        </div>
      </div>

      <!-- City -->
      <div class="col-md-6 mb-3">
        <label class="form-label">City</label>
        <select name="city" class="form-control"
          [(ngModel)]="user.city"
          #city="ngModel"
          required>
          <option value="">Select City</option>
          <option *ngFor="let c of cities" [value]="c">{{ c }}</option>
        </select>
        <div *ngIf="city.invalid && city.touched" class="text-danger small">
          City is required.
        </div>
      </div>

      <!-- Address -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Address</label>
        <input type="text" name="address" class="form-control"
          [(ngModel)]="user.address"
          #address="ngModel"
          required minlength="5"
          placeholder="Enter address">
        <div *ngIf="address.invalid && address.touched" class="text-danger small">
          <div *ngIf="address.errors?.['required']">Address is required.</div>
          <div *ngIf="address.errors?.['minlength']">Minimum 5 characters required.</div>
        </div>
      </div>

      <!-- Password -->
      <div class="col-md-6 mb-3">
        <label class="form-label">Password</label>
        <input type="password" name="password" class="form-control"
          [(ngModel)]="user.password"
          #password="ngModel"
          required minlength="6"
          placeholder="Enter password">
        <div *ngIf="password.invalid && password.touched" class="text-danger small">
          <div *ngIf="password.errors?.['required']">Password is required.</div>
          <div *ngIf="password.errors?.['minlength']">Minimum 6 characters required.</div>
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <button type="submit" class="btn btn-success px-4" [disabled]="customerForm.invalid">
        Add Customer
      </button>
    </div>
  </form>

  <div *ngIf="successMessage" class="alert alert-success mt-4 text-center">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger mt-4 text-center">
    {{ errorMessage }}
  </div>
</div>
