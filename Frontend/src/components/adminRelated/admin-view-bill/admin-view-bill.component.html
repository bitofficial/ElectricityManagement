<nav class="wm-navbar">
  <div class="wm-container">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="bolt">
          <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </div>
      <a href="/"><span class="brand-name">PowerEase Admin</span></a>
    </div>

    <ul class="nav-links">
      <li><a routerLink="/admin/home" style="color:#0EA5A4;">Dashboard</a></li>
      <li><a routerLink="/admin/add-bill">Add Bill</a></li>
      <li><a routerLink="/admin/add-customer" >Add Customer</a></li>
      <li><a routerLink="/admin/update-customer" >Update Customer</a></li>
      <li><a routerLink="/admin/manage-conection" >Manage Connection</a></li>
      <li><a routerLink="/admin/complaints" style="color:red">View Complaints</a></li>
    </ul>
  </div>
</nav>

<div class="container mt-4">
  <h2 class="text-center mb-4">All Bills</h2>

  <!-- Search and Filter Bar -->
  <div class="row mb-3 g-2 align-items-center">
    <div class="col-md-6">
      <input
        type="text"
        class="form-control"
        placeholder="Search by Consumer Number, Bill ID or Month..."
        [(ngModel)]="searchText"
      />
    </div>

    <div class="col-md-3">
      <select class="form-select" [(ngModel)]="filterStatus">
        <option value="">All Status</option>
        <!-- store values lowercase to make comparison simpler -->
        <option value="paid">Paid</option>
        <option value="unpaid">Unpaid</option>
      </select>
    </div>

    <div class="col-md-3 text-end">
      <button class="btn btn-secondary me-2" (click)="loadBills()">Refresh</button>
      <button class="btn btn-outline-primary" (click)="searchText=''; filterStatus='';">Clear</button>
    </div>
  </div>

  <!-- Error or empty state -->
  <div *ngIf="errorMessage" class="alert alert-warning">
    {{ errorMessage }}
  </div>

  <!-- Bills Table -->
  <div class="table-responsive card shadow-sm">
    <table class="table table-hover table-striped mb-0">
      <thead class="table-dark">
        <tr>
          <th>Bill ID</th>
          <th>Consumer No.</th>
          <th>Billing Month</th>
          <th>Units</th>
          <th>Price/unit (₹)</th>
          <th>Amount (₹)</th>
          <th>Due Date</th>
          <th>Status</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let bill of filteredBills()">
          <td>{{ bill.billId }}</td>
          <td>{{ bill.consumerNumber }}</td>
          <td>{{ bill.billingMonth }}</td>
          <td>{{ bill.unitsConsumed | number:'1.0-2' }}</td>
          <td>{{ bill.pricePerUnit | number:'1.2-2' }}</td>
          <td>{{ bill.amount | number:'1.2-2' }}</td>
          <td>
            <!-- dueDate may be 'YYYY-MM-DD' or null; use date pipe if parsable -->
            <span *ngIf="bill.dueDate">{{ bill.dueDate | date:'mediumDate' }}</span>
            <!-- <ng-template #noDue">-</ng-template> -->
          </td>
          <td>
            <span
              class="badge"
              [ngClass]="{
                'bg-success text-white': isPaid(bill.status),
                'bg-danger text-white': !isPaid(bill.status)
              }"
            >
              {{ bill.status ? (bill.status | uppercase) : 'UNPAID' }}
            </span>
          </td>
        </tr>
        <tr *ngIf="filteredBills().length === 0">
          <td colspan="8" class="text-center py-4">No bills found.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>


