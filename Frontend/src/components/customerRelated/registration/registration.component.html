<nav class="wm-navbar">
  <div class="wm-container">
    <div class="brand">
      <div class="logo">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="bolt">
          <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"
                stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </div>
      <a href="/"><span class="brand-name">PowerEase</span></a>
    </div>

    <ul class="nav-links">
      <li><a href="/" style="color: #0ea5a4">Home</a></li>
      <li><a href="/login" class="cta">Login</a></li>
    </ul>
  </div>
</nav>

<div class="register-wrapper d-flex justify-content-center align-items-center">
  <div class="register-card shadow-lg p-4" style="width:700px;">

    <div class="text-center mb-4">
      <svg viewBox="0 0 24 24" class="bolt-icon" fill="none" stroke="currentColor">
        <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"
              stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      <h3 class="fw-bold text-dark mb-1">Customer Registration</h3>
    </div>

    <form (ngSubmit)="registerUser()" class="p-4">

      <!-- Consumer Number -->
      <div class="form-group mb-3">
        <label>Consumer Number</label>
        <input type="text" class="form-control" [(ngModel)]="user.consumerNumber"
               name="consumerNumber" (change)="fetchUserDetails()"
               placeholder="Enter Consumer Number">
      </div>

      <!-- Full Name -->
      <div class="form-group mb-3">
        <label>Full Name</label>
        <input type="text" class="form-control" [(ngModel)]="user.fullName" name="fullName">
      </div>

      <!-- Email -->
      <div class="form-group mb-3">
        <label>Email</label>
        <input type="email" class="form-control" [(ngModel)]="user.email" name="email">
      </div>

      <!-- Phone -->
      <div class="form-group mb-3">
        <label>Phone Number</label>
        <input type="text" class="form-control" [(ngModel)]="user.mobile" name="mobile">
      </div>

      <!-- Connection Type -->
      <div class="form-group mb-3">
        <label>Connection Type</label>
        <select class="form-control" [(ngModel)]="user.customerType" name="customerType">
          <option value="">Choose Type</option>
          <option value="Residential">Residential</option>
          <option value="Commercial">Commercial</option>
        </select>
      </div>

      <!-- Ward -->
      <div class="form-group mb-3">
        <label>Region Ward</label>
        <select class="form-control" [(ngModel)]="user.electricalSection" name="electricalSection">
          <option value="">Choose Ward</option>
          <option value="Ward A">Ward A</option>
          <option value="Ward B">Ward B</option>
          <option value="Ward C">Ward C</option>
        </select>
      </div>

      <!-- PINCODE -->
      <div class="form-group mb-3">
        <label>Pincode</label>
        <input type="text" class="form-control" [(ngModel)]="user.pincode" name="pincode">
      </div>

      <!-- CITY -->
      <div class="form-group mb-3">
        <label>City</label>
        <input type="text" class="form-control" [(ngModel)]="user.city" name="city">
      </div>

      <!-- STATE -->
      <div class="form-group mb-3">
        <label>State</label>
        <input type="text" class="form-control" [(ngModel)]="user.state" name="state">
      </div>

      <!-- ADDRESS -->
      <div class="form-group mb-3">
        <label>Address</label>
        <textarea class="form-control" [(ngModel)]="user.address" name="address"></textarea>
      </div>

      <!-- FIRST LOGIN PASSWORD -->
      <div class="form-group mb-3 d-flex align-items-center">
        <div style="flex:1">
          <label>Enter First Login Password</label>
          <input type="password" class="form-control"
                 [(ngModel)]="firstPassword" name="firstPassword">
        </div>

        <div class="ms-3 mt-4">
          <button type="button"
                  class="btn btn-outline-secondary"
                  (click)="verifyPass($event)">
            Verify
          </button>
        </div>
      </div>

      <!-- NEW PASSWORD -->
      <div class="form-group mb-3">
        <label>Create Password</label>
        <input type="password" class="form-control"
               [(ngModel)]="user.newPassword"
               name="newPassword"
               [disabled]="!isPasswordVerified">
      </div>

      <!-- CONFIRM PASSWORD -->
      <div class="form-group mb-3">
        <label>Confirm Password</label>
        <input type="password" class="form-control"
               [(ngModel)]="user.confirmPassword"
               name="confirmPassword"
               [disabled]="!isPasswordVerified">
      </div>

      <div class="d-flex justify-content-between mt-3">
        <span class="text-danger">{{ errorMessage }}</span>
        <button class="btn btn-primary" type="submit" [disabled]="isLoading">
          {{ isLoading ? 'Registering...' : 'Register' }}
        </button>
      </div>

    </form>
  </div>
</div>

<!-- SUCCESS MODAL -->
<div class="custom-modal-backdrop" *ngIf="showUserIdModal">
  <div class="custom-modal">
    <h4 style="color:green">Registration Success!</h4>
    <p><b>{{ user.userId }}</b></p>

    <button class="btn btn-success btn-sm" (click)="copyUserId()">Copy</button>
    <a href="/login" class="btn btn-info btn-sm mx-2">Proceed to Login</a>
  </div>
</div>

<!-- ERROR MODAL -->
<div class="custom-modal-backdrop" *ngIf="showErrorIdModal">
  <div class="custom-modal">
    <h4 style="color:red">Registration Failed</h4>
    <p><b>Duplicate entry or invalid data!</b></p>
    <button class="btn btn-danger btn-sm" (click)="registerAgain()">Try Again</button>
  </div>
</div>
