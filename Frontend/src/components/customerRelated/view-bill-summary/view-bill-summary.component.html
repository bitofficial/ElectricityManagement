<div class="vbs-root container">
  <h2 class="title">Review & Confirm Selected Bills</h2>

  <!-- Loading state -->
  <div *ngIf="loading" class="loading-area">
    <div class="spinner" aria-hidden="true"></div>
    <div>Loading bills...</div>
  </div>

  <!-- Error state -->
  <div *ngIf="!loading && error" class="error-area card">
    <p class="error-msg">{{ error }}</p>
    <div class="actions">
      <button type="button" class="btn btn-outline-secondary" (click)="goBack()">Back</button>
      <button type="button" class="btn btn-primary" (click)="retry()">Retry</button>
    </div>
  </div>

  <!-- Main content when loaded -->
  <div *ngIf="!loading && !error" class="content card">
    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0">
        <thead class="thead-light">
          <tr>
            <th style="width:48px"></th>
            <th>Consumer Number</th>
            <th>Bill Date</th>
            <th>Billing Period</th>
            <th class="text-right">Bill Amount</th>
            <th>Due Date</th>
            <th style="width:120px">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bill of bills">
            <td>
              <input type="checkbox" [(ngModel)]="bill.selected" (change)="toggleSelection(bill)" [attr.aria-label]="'Select bill ' + bill.id" />
            </td>
            <td>{{ bill.consumerNumber }}</td>
            <td>{{ bill.billDate }}</td>
            <td>{{ bill.billingPeriod }}</td>
            <td class="text-right">{{ formatCurrency(bill.billAmount) }}</td>
            <td>{{ bill.dueDate }}</td>
            <td>
              <button class="btn btn-sm btn-outline-danger" (click)="deselectBill(bill)" [disabled]="!bill.selected" title="Deselect">
                Deselect
              </button>
            </td>
          </tr>
          <tr *ngIf="bills.length === 0">
            <td colspan="7" class="text-center">No bills to display.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Summary & Payment area -->
    <div class="summary-row d-flex justify-content-between align-items-center mt-3">
      <div class="payment-options">
        <label class="small mb-1">Payment Method</label>
        <div class="d-flex gap-3">
          <label class="option">
            <input type="radio" name="payment" value="credit_card" [(ngModel)]="paymentMethod"> Credit Card
          </label>
          <label class="option">
            <input type="radio" name="payment" value="debit_card" [(ngModel)]="paymentMethod"> Debit Card
          </label>
          <label class="option">
            <input type="radio" name="payment" value="net_banking" [(ngModel)]="paymentMethod"> Net Banking
          </label>
        </div>
      </div>

      <div class="totals text-right">
        <div class="total-label">Total for selected bills</div>
        <div class="total-amount">â‚¹ {{ formatCurrency(totalAmount) }}</div>
      </div>
    </div>

    <div *ngIf="proceedDisabledMsg" class="alert alert-warning mt-2">
      {{ proceedDisabledMsg }}
    </div>

    <!-- Action buttons -->
    <div class="actions-row d-flex justify-content-between align-items-center mt-3">
      <div>
        <button class="btn btn-outline-secondary" (click)="goBack()">Back</button>
      </div>
      <div>
        <button class="btn btn-primary btn-lg"
                [disabled]="!anySelected || !paymentMethod"
                (click)="proceedToPayment()">
          Proceed to Payment
        </button>
      </div>
    </div>
  </div>
</div>
