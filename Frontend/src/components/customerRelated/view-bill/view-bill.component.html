<!-- ✅ Navbar -->
<nav class="wm-navbar">
  <div class="wm-container">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="bolt">
          <path
            d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"
            stroke-width="1.2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>
      <a href="/"><span class="brand-name">PowerEase</span></a>
    </div>

    <ul class="nav-links">
      <li><a routerLink="/customer/home" style="color: #0EA5A4;">Dashboard</a></li>
      <li><a routerLink="/customer/pay-bill">Pay Bills</a></li>
      <li><a routerLink="/customer/complaint-status">Search Complaint</a></li>
      <li><a routerLink="/customer/register-complaint" style="color: red;">Register Complaint</a></li>
    </ul>
  </div>
</nav>

<!-- ✅ Main Container -->
<div class="container mt-4">
  <h2 class="text-center mb-4">View / Pay Bills</h2>

  <!-- ✅ Search (manual) -->
  <div class="card p-3 shadow-sm mb-3">
    <div class="row g-2 align-items-end">
      <div class="col-md-7">
        <label for="searchBill" class="form-label">Search by Bill Number</label>
        <input
          id="searchBill"
          type="text"
          class="form-control"
          placeholder="Enter exact Bill Number"
          [(ngModel)]="searchTerm"
          (keyup.enter)="searchBills()"
          [ngModelOptions]="{standalone: true}"
        />
      </div>

      <div class="col-md-3 d-grid">
        <button class="btn btn-primary" (click)="searchBills()">Search</button>
      </div>

      <div class="col-md-2 d-grid">
        <button class="btn btn-link" (click)="clearSearch()">Clear</button>
      </div>
    </div>
  </div>

  <!-- ✅ Loading Indicator -->
  <div *ngIf="loading" class="alert alert-info text-center">Loading bills...</div>

  <!-- ✅ Error Message -->
  <div *ngIf="!loading && errorMessage  && filtered.length === 0" class="alert alert-danger text-center top-alert">
    {{ errorMessage }}
  </div>

  <!-- ✅ Empty State 
  <div *ngIf="!loading && !errorMessage && filtered.length === 0" class="alert alert-warning text-center">
    No bills found.
  </div> -->

  <!-- ✅ Bill Table -->
  <div *ngIf="!loading && filtered.length > 0" class="card mt-2 shadow-sm p-3">
    <h4 class="mb-3">Bill Details</h4>

    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr class="text-center">
            <th>Select</th>
            <th>Consumer No</th>
            <th>Bill Number</th>
            <th>Payment Status</th>
            <!-- <th>Connection Type</th>
            <th>Connection Status</th> -->
            <!-- <th>Mobile Number</th> -->
            <th>Bill Date</th>
            <th>Bill Period</th>
            <th>Due Date</th>
            <th>Disconnection Date</th>
            <th>Due Amount (₹)</th>
            <th>Payable Amount (₹)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bill of filtered" class="text-center">
            <td >
  <input type="checkbox" [(ngModel)]="bill.selected" (change)="updateTotal()" [ngModelOptions]="{standalone: true}"  [disabled]="bill.paymentStatus === 'Paid'" />
</td>

            <td>{{ bill.consumerNo }}</td>
            <td>{{ bill.billId }}</td>
            <td>
              <span [ngClass]="bill.paymentStatus === 'Paid' ? 'text-success' : 'text-danger'">
                {{ bill.paymentStatus }}
              </span>
            </td>
            <!-- <td>{{ bill.connectionType }}</td> -->
            <!-- <td>{{ bill.connectionStatus }}</td> -->
            <!-- <td>{{ bill.mobileNumber }}</td> -->
            <td>{{ bill.generated_at|date:'dd-MMM-yyyy' }}</td>
            <td>{{ bill.billingMonth | date:'MMM-yyyy' }}</td>
            <td>{{ bill.dueDate | date }}</td>
           <td>{{ getDisconnectionDate(bill.dueDate) | date:'dd-MMM-yyyy' }}</td>


            <td>{{ bill.dueAmount | number:'1.2-2' }}</td>
            <td>
              <input
                type="number"
                class="form-control text-center"
                [(ngModel)]="bill.payableAmount"
                disabled
                (input)="updateTotal()"
                min="0"
                [ngModelOptions]="{standalone: true}"
              />
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ✅ Total + Proceed -->
    <div class="d-flex justify-content-between align-items-center mt-3">
      <h5>Total Amount Payable: ₹{{ totalAmount | number: '1.2-2' }}</h5>
      <button
        class="btn btn-success"
        (click)="proceedToSummary()"
        [disabled]="!hasSelected"
        title="Select at least one bill to proceed"
      >
        Proceed
      </button>
    </div>
  </div>
</div>
